<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Errors</title>
    <!-- Bootstrap core CSS -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../css/prompto-frame.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/lib/jquery.min.js"></script>
    <script src="../../js/lib/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../js/lib/ie10-viewport-bug-workaround.js"></script>

    <script type="text/javascript">

        var samples = {
            c1: "define main as method doing:"
            + "\n" + "    switch on error doing:"
            + "\n" + '        print "1/0 -> " + 1/0'
            + "\n" + '    when DIVIDE_BY_ZERO:'
            + "\n" + '        print error.text',
            c2: "define BadContentError as enumerated Error with symbols:"
            + "\n" + "    MISSING_PRODUCT with \"Expecting 'product' in file!\" as text"
            + "\n" + "    MISSING_PRICE with \"Could not find 'price' for product!\" as text"
            + "\n"
            + "\n" + "define checkContent as method receiving Text text doing:"
            + "\n" + '    if "product" not in text:'
            + "\n" + '        raise MISSING_PRODUCT'
            + "\n"
            + "\n" + "define main as method doing:"
            + "\n" + "    switch on error doing:"
            + "\n" + '       checkContent "some invalid content"'
            + "\n" + '    when any:'
            + "\n" + '       print error.text'


            };

        function editorReady(frame, editor) {
            editor.setValue(samples[frame.name], -1);
        }

        function translatePromptoCode(content, from, to, editor) {
            parent.translatePromptoCode(content, from, to, editor);
        }

        function executePromptoCode(content, dialect, printer) {
            parent.executePromptoCode(content, dialect, printer);
        }

    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <h2>Error handling</h2>

        <p>Error handling is critical to perception of quality. Even is your application code is correct, it may
            generate errors.
            These errors may emanate from hardware (disk, network, memory), from middleware (credentials, service down),
            or from your application itself if your code meets undesirable situations and raises corresponding user
            defined errors.
        </p>

        <p>Prompto implements error handling using a try/fail mechanism. Here is an example:
        </p>


        <div>
            <iframe class="displayer" name="c1" class="embed-responsive-item" src="../../code/displayer.html" runnable></iframe>
        </div>
        <p>In the above example, we try to perform an illegal operation (divide by zero).
            Without precaution, this error would simply force the application to abruptly exit.
            To avoid this, we <i>protect</i> the potential error by wrapping our code inside a try/fail block.</p>
        <p>A try/fail block has the following structure:
        <ul>
            <li><code>switch on <i>error</i> doing:</code><br/>
                &emsp;list of <i>protected</i> statements</li>
            <li><code>when <i>type</i>:</code><br/>
                &emsp;list of statements</li>
            <li><code>when in [ <i>type1</i>, <i>type2</i>, ... ]:</code><br/>
                &emsp;list of statements</li>
            <li><code>otherwise</code> or <code>when any</code><br/>
                &emsp;list of statements</li>
            <li><code>always:</code><br/>
                &emsp;list of statements</li>
        </ul>
        where <code><i>error</i></code> is a variable name which will be populated with the error object,
        and can be used in the corresponding handler section.<br/>
        The block must comprise <u><i>at least one</i></u> <i>handler</i>, either a <code>when</code>,
        a <code>when in</code>, a <code>when any</code> or an <code>always</code> clause.<br/>
        There can be any number of <code>when</code> or <code>when in</code> clauses.<br/>
        If present, the <code>when any</code> or <code>otherwise</code> clause must come after all <code>when</code> and <code>when any</code> clauses,
        and before the <code>always</code> clause.<br/>
        If present, the <code>always</code> clause must be the last one.
        </p>
        <p><ul>Examples of correct sequences:
<li>
<pre>switch on error doing:
    <i>list of statements</i>
when in [NOT_MUTABLE, NOT_STORABLE]:
    <i>list of statements</i></pre>
</li>
<li>
<pre>switch on error doing:
    <i>list of statements</i>
always:
    <i>list of statements</i></pre>
</li>
<li>
<pre>switch on error doing:
    <i>list of statements</i>
when NULL_REFERENCE:
    <i>list of statements</i>
otherwise:
    <i>list of statements</i>
</pre>
</li>
<li>
<pre>switch on error doing:
    <i>list of statements</i>
when any:
    <i>list of statements</i>
always:
    <i>list of statements</i>
</pre>
        </li>
    </ul></p>
        <p>The execution is as follows:
        <ul>
            <li>Prompto tries to execute the list of <i>protected</i> statements</li>
            <li>if an error occurs:
            <ul>
                <li>Prompto looks for the first <code>when</code> clause that accepts the error type
                <ul>
                    <li>if such a clause exists, Prompto executes the correponding list of statements</li>
                    <li>otherwise if a <code>when any</code> clause exists, Prompto executes the correponding list of statements</li>
                </ul>
                </li>
            </ul>
            <li>whether or not an error occurs:
                <ul><li>if there is an <code>always</code> clause, Prompto executes the correponding list of statements</li></ul>
            </li>
        </ul>
        </p>

        <h2>Built-in errors</h2>
        <p>Prompto is focused on business logic, so it does not provide a wide variety of error types. Instead it lets
            the underlying runtime provide details on those errors.</p>
        <p>All built-in errors are defined in the built-in <code>Error</code> enumerated category.</p>
        <p>The list of built-in errors is:
        <ul>
            <li>READ_WRITE: a read/write error can occur when reading or writing from a resource: file, url, database
                and so forth
            </li>
            <li>NULL_REFERENCE: a null reference occurs when trying to access a member attribute or method from a null
                object
            </li>
            <li>INDEX_OUT_OF_RANGE: this error occurs when trying to access a list element < 1 or > to the number of
                elements in the list
            </li>
            <li>DIVIDE_BY_ZERO: this error occurs when trying to divide a number by 0</li>
            <li>NOT_MUTABLE: this error occurs when trying to set a member attribute on a non mutable object</li>
            <li>NOT_STORABLE: this error occurs when trying to stor an object of a category not marked as storable</li>
        </ul>
        <p/>
        <h2>User defined errors</h2>
        <p>There are situations not covered by built-in errors. For example, if your program reads text from a file,
            and expects certain content in that text but cannot find it, you might want to raise a specific error.</p>
        <p>Prompto lets you define errors, which extend the built-in <i>Error</i> enumeration of errors.</p>
        <p>Here is an example:</p>
<pre>
define BadContentError as enumerated Error with symbols:
    MISSING_PRODUCT with "Expecting 'product' in file!" as text
    MISSING_PRICE with "Could not find 'price' for product!" as text
</pre>
      <p>User defined errors simply accept a <i>text</i> attribute, which can be displayed or logged.</p>
        <p>Once user errors are defined, they can be <i>raised</i> using the <code>raise</code> keyword:</p>
        <div>
            <iframe class="displayer displayer-16-lines" name="c2" class="embed-responsive-item" src="../../code/displayer.html" runnable></iframe>
        </div>
    </div>
</body>
</html>