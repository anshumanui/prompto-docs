<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Methods</title>
    <!-- Bootstrap core CSS -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../css/prompto-frame.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/lib/jquery.min.js"></script>
    <script src="../../js/lib/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../js/lib/ie10-viewport-bug-workaround.js"></script>

    <script type="text/javascript">

        var samples =  {
            c1 : "define login as Text attribute"
            + "\n" + "define password as Text attribute"
            + "\n"
            + "\n" + "define Configuration as singleton with attributes login and password"
            + "\n"
            + "\n" + "define main as method doing:"
            + "\n" + '    with Configuration, do:'
            + "\n" + '        login = "prompto-login"'
            + "\n" + '        password = "xYz3!?th22"'
            + "\n" + '    print "login -> " + Configuration.login',
            c2 : "define login as Text attribute"
            + "\n" + "define password as Text attribute"
            + "\n"
            + "\n" + "define Configuration as singleton with attributes login and password, and methods:"
            + "\n"
            + "\n" + "    define readFromResource as method doing:"
            + "\n" + "        // can't read file from a browser, but you get it"
            + "\n" + '        login = "prompto-login"'
            + "\n" + '        password = "xYz3!?th22"'
            + "\n"
            + "\n" + "define main as method doing:"
            + "\n" + '    with Configuration, do:'
            + "\n" + "        readFromResource"
            + "\n" + '    print "login -> " + Configuration.login'
        };

        function editorReady(frame, editor) {
            editor.setValue(samples[frame.name], -1);
        }

        function translatePromptoCode(content, from, to, editor) {
            parent.translatePromptoCode(content, from, to, editor);
        }

        function executePromptoCode(content, dialect, printer) {
            parent.executePromptoCode(content, dialect, printer);
        }

    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <h2>Singletons</h2>
        <p>There are situations which require having one and only one instance of a given category.</p>
        <p>If, for example, you were to define a <i>World</i> category, chances are you would only need one instance.</p>
        <p>Prompto directly supports this concept through <i>Singletons</i>, a specialized category which has one and only one instance.</p>
        <p>Being a specialized category, a singleton supports most category features i.e. attributes and methods except the following:
            <ul>
                <li>a singleton cannot derive from another category or singleton</li>
                <li>a singleton cannot contain abstract methods</li>
                <li>a singleton cannot be instantiated</li>
                <li>a singleton cannot be made <i>mutable</i></li>
            </ul>
        </p>
        <h3>Accessing singleton attributes and methods</h3>
        <p>Singleton attributes and methods are accessible using the singleton name, which serves as both a type and the only instance.</p>
        <h3>Populating singleton attributes</h3>
        <p>An immutable singleton would not be very useful, since it would only hold constant values known at coding time. On the other hand, it would be very
            difficult to ensure consistency of a mutable singleton in the context of multiple Workers. Prompto solves this problem using <code>with</code> blocks.</p>
        <p>In the below example, we:
        <ul>
            <li>define a 'Configuration' singleton</li>
            <li>populate its attributes inside a <code>with</code> block</li>
            <li>read an attribute directly from the singleton</li>
        </ul>
        </p>

       <div>
            <iframe class="displayer displayer-12-lines" name="c1" class="embed-responsive-item" src="../../code/displayer.html" runnable></iframe>
        </div>

        <p>In the above example, it is safe to read <i>login</i> outside a <code>with</code> block, because it only involves reading one value.</p>

        <h3>Calling singleton methods</h3>
        <p>Singleton methods are likely to:
        <ul><li>access more than one attribute</li>
            <li>change the singleton's attribute values </li>
        </ul>
        For those reasons, singleton methods can only be called within <code>with</code> blocks:</p>
        <div>
            <iframe class="displayer displayer-16-lines" name="c2" class="embed-responsive-item" src="../../code/displayer.html" runnable></iframe>
        </div>

        <h3>How the <code>with</code> block works</h3>
        <p>The <code>with</code> block ensures that only the main program or one Worker at a time can execute the statements contained in <code>with</code> block body.
            This protection spans across all <code>with</code> blocks for a given singleton. Internally, the main program or Worker takes ownership of the singleton until all
            statements in the block body are executed, thus blocking any other worker from simultaneously entering any <code>with</code> block for the singleton.</p>
        <p><i>JavaScript Workers do not share data. Although Prompto supports singletons on all platforms, developers are advised to avoid them in a browser if they use Workers,
            because using them can significantly slow down execution.</i></p>
    </div>
</body>
</html>